xvcv_mdlc_planet_cracker_incomplete = {
	entity = "construction_platform_entity"
	construction_entity = "construction_platform_entity"
	portrait = "GFX_megastructure_xvcv_mdlc_planet_cracker"
	place_entity_on_planet_plane = no
	show_galactic_map_icon = no

	construction_blocks_and_blocked_by = none

	potential = {
		always = no
	}
}
xvcv_mdlc_planet_cracker = {
	entity = "xvcv_mdlc_planet_cracker_entity"
	portrait = "GFX_megastructure_xvcv_mdlc_planet_cracker"
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	show_in_outliner = no

	

	build_time = 720

	construction_blocks_and_blocked_by = none

	upgrade_from = {
		xvcv_mdlc_planet_cracker_incomplete
	}
	
	on_build_complete = {
		fromfrom.planet = {
			set_planet_flag = has_megastructure
			if = {
				limit = { planet_size > 10 }
				set_planet_size = 10
			}
			if = {
				limit = {
					NOR = {
						is_planet_class = pc_shattered
						is_planet_class = pc_habitat
						is_planet_class = pc_ringworld_habitable
						is_planet_class = pc_ringworld_habitable_damaged
						is_planet_class = pc_ringworld_tech
						is_planet_class = pc_ringworld_tech_damaged
						is_planet_class = pc_ringworld_seam
						is_planet_class = pc_ringworld_seam_damaged
					}
				}
				change_pc = pc_shattered
			}
			else_if = {
				limit = { is_planet_class = pc_habitat }
				remove_planet = yes
				spawn_habitat_cracker_effect = yes
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_habitable }
				change_pc = pc_ringworld_habitable_damaged
				spawn_ringworld_cracker_effect = yes
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_tech }
				change_pc = pc_ringworld_tech_damaged
				spawn_ringworld_cracker_effect = yes
			}
			else_if = {
				limit = { is_planet_class = pc_ringworld_seam }
				change_pc = pc_ringworld_seam_damaged
				spawn_ringworld_cracker_effect = yes
			}
		}
	}

	# Follow space mining tech upgrades
	# Base is 10, with tech upgrades:
	# T1 = 11, T2 = 12.1, T3 = 13.25, T4 = 14.5, T5 = 16
	# Bonuses
	# T1 = +1, T2 = +1.1, T3 = +1.15, T4 = 1.25, T5 = +1.5
	# Base 14 (Base + first upgrade)
	# T1 = 15.5 (+1.5), T2 = 17 (+1.5), T3 = 18.75 (+1.75), T4 = 20.6 (+1.85), T5 = 22.66 (+2)
	resources = {
		# category = station_gatherers
		category = orbital_mining_deposits
		produces = { minerals = 10 }
		upkeep = { energy = 5 }
		# The effects are compound additive
		# Base 10, plus tech 1, and tech 2 = 20 output

		### NO TECH UPGRADES ###
		# with NO tech upgrades, calculate bonuses of T1-T5 space mining on base 10 mineral production
		produces = {
			trigger = { 
				owner = {
					NOR = {
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					}
					has_technology = tech_space_mining_1
					NOT = { has_technology = tech_space_mining_2 }
				}
			}
			minerals = 1 # 10% of base 10
		}
		produces = {
			trigger = { 
				owner = {
					NOR = {
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					}
					has_technology = tech_space_mining_2
					NOT = { has_technology = tech_space_mining_3 }
				}
			}
			minerals = 2.1
		}
		produces = {
			trigger = { 
				owner = {
					NOR = {
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					}
					has_technology = tech_space_mining_3
					NOT = { has_technology = tech_space_mining_4 }
				}
			}
			minerals = 3.25
		}
		produces = {
			trigger = { 
				owner = {
					NOR = {
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					}
					has_technology = tech_space_mining_4
					NOT = { has_technology = tech_space_mining_5 }
				}
			}
			minerals = 4.5
		}
		produces = {
			trigger = { 
				owner = {
					NOR = {
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
						has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					}
					has_technology = tech_space_mining_5
					# NOT = { has_technology = tech_space_mining_5 }
				}
			}
			minerals = 6
		}
		### TECH 1 ###
		# Base 10 + 4 = Base 14
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					NOT = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 }
					has_technology = tech_space_mining_1
					NOT = { has_technology = tech_space_mining_2 }
				}
			}
			minerals = 1.5 # 10% of base 14
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					NOT = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 }
					has_technology = tech_space_mining_2
					NOT = { has_technology = tech_space_mining_3 }
				}
			}
			minerals = 3
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					NOT = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 }
					has_technology = tech_space_mining_3
					NOT = { has_technology = tech_space_mining_4 }
				}
			}
			minerals = 4.75
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					NOT = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 }
					has_technology = tech_space_mining_4
					NOT = { has_technology = tech_space_mining_5 }
				}
			}
			minerals = 6.6
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					NOT = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 }
					has_technology = tech_space_mining_5
				}
			}
			minerals = 8.5
		}
		### TECH 2 ###
		# Base 10 + 4 + 6 = Base 20
		# T1 = 22 (+2), T2 = 24.2 (+4.2), T3 = 26.62 (+6.62), T4 = 29.25 (+9.25), T5 = 32.15 (+12.15)
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					has_technology = tech_space_mining_1
					NOT = { has_technology = tech_space_mining_2 }
				}
			}
			minerals = 2
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					has_technology = tech_space_mining_2
					NOT = { has_technology = tech_space_mining_3 }
				}
			}
			minerals = 4.2
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					has_technology = tech_space_mining_3
					NOT = { has_technology = tech_space_mining_4 }
				}
			}
			minerals = 6.5
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					has_technology = tech_space_mining_4
					NOT = { has_technology = tech_space_mining_5 }
				}
			}
			minerals = 9.25
		}
		produces = {
			trigger = { 
				owner = {
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1
					has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2
					has_technology = tech_space_mining_5
				}
			}
			minerals = 12.15
		}

		#with tech 1
		produces = {
			trigger = { owner = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1 } }
			minerals = 4
		}
		#with tech 2
		produces = {
			trigger = { owner = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 } }
			minerals = 6
		}

		upkeep = {
			# tech 1
			trigger = { owner = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_1 } }
			energy = 2
		}
		upkeep = {
			# tech 2
			trigger = { owner = { has_technology = xvcv_mdlc_tech_orbital_cracker_upgrade_2 } }
			energy = 3
		} 
	
		# # Councilor has 'trait_ruler_space_miner'
		# produces = {
		# 	trigger = { owner = { any_owned_leader = { has_trait = trait_ruler_space_miner } } }
		# 	minerals = 0.5
		# }
		# # Prosperity tradition
		# produces = {
		# 	trigger = { owner = { has_tradition = tr_prosperity_adopt } }
		# 	minerals = 1
		# }

	}
}
xvcv_mdlc_planet_cracker_2 = {
	entity = "xvcv_mdlc_planet_cracker_entity"
	portrait = "GFX_megastructure_xvcv_mdlc_planet_cracker"
	place_entity_on_planet_plane = yes
	show_galactic_map_icon = no
	show_in_outliner = no

	build_time = 180

	resources = {
		category = megastructures
		cost = {
			energy = 500
		}
	}

	construction_blocks_and_blocked_by = none

	upgrade_from = {
		xvcv_mdlc_planet_cracker
	}
	
	on_build_complete = {
		from = {
			add_resource = {
				alloys = 100
			}
		}
		remove_megastructure = fromfrom
		fromfrom.planet = {
			remove_planet_flag = has_megastructure
			remove_planet_flag = xvcv_mdlc_planet_cracker_placed
		}
	}
}